<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discover the Art of Pysanky</title>
<style>
body { font-family: Arial, sans-serif; background:#f7f4ef; margin:0; padding:20px; }
.container { max-width:800px; margin:auto; }
h1 { text-align:center; }
.session { background:white; padding:20px; border-radius:8px; margin-bottom:20px; }
button { padding:10px 15px; cursor:pointer; }
input, select { width:100%; padding:8px; margin:8px 0; }
.seats { font-weight:bold; }
.full { color:red; font-weight:bold; }
.total { font-weight:bold; font-size:18px; margin-top:10px; }
</style>
</head>
<body>
<div class="container">

<h1>Discover the Art of Pysanky</h1>
<p><strong>Cost:</strong> $30 per person</p>

<div class="session">
<h2>March 14 | 12:00 PM</h2>
<p>Madeira Silverwood Presbyterian Church<br>
8000 Miami Ave, Madeira, OH 45243</p>
<p class="seats" id="seatDisplay">Checking seats...</p>
</div>

<h2>Register</h2>
<form id="registrationForm">
<input type="text" name="name" placeholder="Full Name" required>
<input type="email" name="email" placeholder="Email Address" required>

<label>Optional Donation (in $5 increments)</label>
<select name="donation" id="donationSelect">
<option value="0">No Donation</option>
<option value="5">$5</option>
<option value="10">$10</option>
<option value="15">$15</option>
<option value="20">$20</option>
<option value="25">$25</option>
<option value="30">$30</option>
<option value="35">$35</option>
<option value="40">$40</option>
<option value="45">$45</option>
<option value="50">$50</option>
</select>

<p class="total" id="totalDisplay">Total Due: $30</p>

<button type="submit">Register</button>
</form>

<h2>Payment Options</h2>
<p>
<a href="https://www.paypal.com/paypalme/TatyanaPinyayev" target="_blank">Pay with PayPal</a><br>
<a href="https://venmo.com/Tatyana-Pinyayev" target="_blank">Pay with Venmo</a><br>
Zelle: 513-607-8364
</p>

</div>

<script>
const seatLimit = 15;
const className = "March14";
const scriptURL = "https://script.google.com/macros/s/AKfycbwSeHvvWMoPWVPMeUPsVeevBDW90i17LIGHV1Y_38KmkdntH6zjIXdlOJW2kSIUHGMczQ/exec";

const donationSelect = document.getElementById("donationSelect");
const totalDisplay = document.getElementById("totalDisplay");

// Update total automatically
function updateTotal() {
    const donation = parseInt(donationSelect.value);
    const total = 30 + donation;
    totalDisplay.innerText = "Total Due: $" + total;
}

donationSelect.addEventListener("change", updateTotal);
updateTotal();

// Load real seat count from Google Sheets
async function loadSeats() {
    const response = await fetch(scriptURL + "?action=getSeats");
    const data = await response.json();
    const taken = data[className] || 0;
    const remaining = seatLimit - taken;

    const seatDisplay = document.getElementById("seatDisplay");
    if (remaining <= 0) {
        seatDisplay.innerHTML = "Class Full";
        seatDisplay.classList.add("full");
        document.querySelector("button").disabled = true;
    } else {
        seatDisplay.innerHTML = remaining + " seats remaining";
    }
}

// Submit registration
const form = document.getElementById("registrationForm");
form.addEventListener("submit", async function(e) {
    e.preventDefault();

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.session = className;

    const response = await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(data)
    });

    const result = await response.text();
    alert(result);
    form.reset();
    updateTotal();
    loadSeats();
});

loadSeats();
</script>

</body>
</html>
