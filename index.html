<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discover the Art of Pysanky</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f6f3ee;
  margin: 0;
  padding: 20px;
}

.container {
  max-width: 900px;
  margin: auto;
}

h1 {
  text-align: center;
  font-size: 40px;
}

.subtitle {
  text-align: center;
  margin-bottom: 30px;
}

.content {
  display: flex;
  flex-wrap: wrap;
  gap: 30px;
}

.left, .right {
  flex: 1;
  min-width: 300px;
}

.main-image {
  width: 100%;
  border-radius: 10px;
}

input, select {
  width: 100%;
  padding: 10px;
  margin: 8px 0;
  font-size: 16px;
}

button {
  background: #9c96c9;
  color: white;
  padding: 12px;
  font-size: 18px;
  border: none;
  width: 100%;
  cursor: pointer;
  border-radius: 6px;
}

button:disabled {
  background: #aaa;
}

.seats {
  margin-top: 10px;
  font-weight: bold;
  color: #a65c00;
}

.total {
  font-weight: bold;
  margin-top: 10px;
}

.qr {
  text-align: center;
  margin-top: 20px;
}

.qr img {
  width: 200px;
}

footer {
  margin-top: 40px;
  text-align: center;
}
</style>
</head>

<body>

<div class="container">

<h1>Discover the Art of Pysanky</h1>
<p class="subtitle">
Join our hands-on workshop and learn traditional Ukrainian egg decorating.
</p>

<div class="content">

<div class="left">

<!-- FIXED IMAGE PATH -->
<img src="./pysanky.png" class="main-image" 
     onerror="this.style.display='none'">

<h3>March 14 at 12:00 PM</h3>
<p>
Madeira Silverwood Presbyterian Church<br>
8000 Miami Ave<br>
Madeira, OH 45243
</p>

<p class="seats" id="seatDisplay">Loading seats...</p>

<form id="registrationForm">
<input type="text" name="name" placeholder="Full Name" required>
<input type="email" name="email" placeholder="Email Address" required>

<label>Optional Donation ($5 increments)</label>
<select name="donation" id="donationSelect">
<option value="0">$0</option>
<option value="5">$5</option>
<option value="10">$10</option>
<option value="15">$15</option>
<option value="20">$20</option>
<option value="25">$25</option>
<option value="30">$30</option>
<option value="35">$35</option>
<option value="40">$40</option>
<option value="45">$45</option>
<option value="50">$50</option>
</select>

<p class="total" id="totalDisplay">Total Due: $30</p>

<button type="submit">Register</button>
</form>

</div>

<div class="right">
<div class="qr">
<h3>Scan to Register</h3>
<img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://tatpin.github.io/pysanky-workshop/" alt="QR Code">
</div>
</div>

</div>

<footer>
PayPal: Tatyana Pinyayev<br>
Venmo: @Tatyana-Pinyayev<br>
Zelle: 513-607-8364
</footer>

</div>

<script>

const seatLimit = 15;
const className = "March14";

/* ðŸ”´ PASTE YOUR GOOGLE APPS SCRIPT WEB APP URL BELOW */
const scriptURL = "PASTE_YOUR_GOOGLE_SCRIPT_URL_HERE";

const donationSelect = document.getElementById("donationSelect");
const totalDisplay = document.getElementById("totalDisplay");

function updateTotal() {
  const donation = parseInt(donationSelect.value);
  totalDisplay.innerText = "Total Due: $" + (30 + donation);
}

donationSelect.addEventListener("change", updateTotal);
updateTotal();

/* SAFE SEAT LOADING WITH ERROR HANDLING */
async function loadSeats() {
  const seatDisplay = document.getElementById("seatDisplay");

  try {
    const response = await fetch(scriptURL + "?action=getSeats");
    const data = await response.json();

    const taken = data[className] || 0;
    const remaining = seatLimit - taken;

    if (remaining <= 0) {
      seatDisplay.innerText = "Class Full";
      document.querySelector("button").disabled = true;
    } else {
      seatDisplay.innerText = remaining + " seats remaining";
    }

  } catch (error) {
    seatDisplay.innerText = "Seat count unavailable (check script URL)";
    console.error("Seat load error:", error);
  }
}

const form = document.getElementById("registrationForm");

form.addEventListener("submit", async function(e) {
  e.preventDefault();

  try {
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    data.session = className;

    const response = await fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify(data)
    });

    const result = await response.text();
    alert(result);

    form.reset();
    updateTotal();
    loadSeats();

  } catch (error) {
    alert("Registration failed. Check your Google Script deployment.");
    console.error("Submit error:", error);
  }
});

loadSeats();

</script>

</body>
</html>
